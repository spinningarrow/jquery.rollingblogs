(function($,google,undefined){google.load("feeds","1");function fetchFeeds(feeds){var deferreds=[];$(feeds).each(function(index,feedUrl){deferreds[index]=$.Deferred();var feed=new google.feeds.Feed(feedUrl);feed.setResultFormat(google.feeds.Feed.JSON_FORMAT);feed.setNumEntries(1);feed.load(function(result){result.feed.lastPublished=new Date(result.feed.entries[0].publishedDate);deferreds[index].resolve(result.feed)})});return $.map(deferreds,function(deferred){return deferred.promise()})}function sortFeeds(feedsDeferreds){var deferred=$.Deferred();$.when.apply($,feedsDeferreds).done(function(){var sortedFeeds=$.makeArray(arguments).sort(lastPublishedSorter);deferred.resolve(sortedFeeds)});return deferred.promise()}function lastPublishedSorter(a,b){return new Date(b.lastPublished).getTime()-new Date(a.lastPublished).getTime()}$.fn.rollingblogs=function(options){return this.each(function(){var $element=$(this);options=typeof options==="object"?options:{};options.template=typeof options.template==="function"?options.template:function(value){return""+'<li><a href="'+value.link+'" title="'+value.author+'" data-feed="'+value.feedUrl+'">'+(value.title||value.link)+'</a> <time datetime="'+value.lastPublished+'">'+value.lastPublished+"</time></li>"};var feeds=$.map($element.find("[data-feed]"),function(item){return $(item).data("feed")});google.setOnLoadCallback(function(){sortFeeds(fetchFeeds(feeds)).done(function(sortedFeeds){var htmlResult=[];$(sortedFeeds).each(function(index,value){htmlResult.push(options.template(value))});$element.html(htmlResult.join(""))})})})}})(jQuery,google);